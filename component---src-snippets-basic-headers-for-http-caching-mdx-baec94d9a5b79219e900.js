"use strict";(self.webpackChunkmarvin_frachet=self.webpackChunkmarvin_frachet||[]).push([[759],{80:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return i},default:function(){return m}});var n=a(3366),l=(a(7294),a(4983)),r=a(4655),s=["components"],i={},o={_frontmatter:i},c=r.Z;function m(e){var t=e.components,a=(0,n.Z)(e,s);return(0,l.kt)(c,Object.assign({},o,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",null,"Etag"),(0,l.kt)("p",null,(0,l.kt)("code",{parentName:"p",className:"language-text"},"etat"),' means "Entity Tag". It aims to set the version of a given resource.'),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"A flow:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"When creating a response on the server, put a ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"etag")," header with a value"),(0,l.kt)("li",{parentName:"ul"},"When a new request comes in, compare the ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"if-none-match")," header with the previously generated ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"etag"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"If they match, return a ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"304")," and forget about setting the body"),(0,l.kt)("li",{parentName:"ul"},"If they don't match, set the ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"etag")," and repeat this process")))),(0,l.kt)("h2",null,"max-age"),(0,l.kt)("p",null,(0,l.kt)("code",{parentName:"p",className:"language-text"},"max-age")," allows to cache an HTTP response in the browser for ",(0,l.kt)("code",{parentName:"p",className:"language-text"},"N")," seconds."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"A flow:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"When creating a response on the server, put a ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"max-age=N")," (here, ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"N=10"),") header with a number of seconds"),(0,l.kt)("li",{parentName:"ul"},"When a new request comes in",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"If the user has already visited the page during the last ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"N")," seconds, get the response from the cache (in chrome ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"Network"),", in the ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"Size")," column, there is ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"disk-cache")," or ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"memory-cache"),")"),(0,l.kt)("li",{parentName:"ul"},"If the user has not visited the page the page in ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"N")," seconds after its last visit, then, make a new HTTP request")))),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Hint: putting a very high max-age on static assets generated with hashes, like webpack build artifacts is generally a good idea"),"."),(0,l.kt)("h2",null,"CDN caching"),(0,l.kt)("p",null,(0,l.kt)("code",{parentName:"p",className:"language-text"},"max-age")," is also used by CDN. If people want to define two different values for the CDN and for the origin server, ",(0,l.kt)("code",{parentName:"p",className:"language-text"},"s-max-age")," can be set and the CDN will only take care of this one and forward the ",(0,l.kt)("code",{parentName:"p",className:"language-text"},"max-age")," one to the origin server.\nHaving a bigger ",(0,l.kt)("code",{parentName:"p",className:"language-text"},"s-max-age")," than ",(0,l.kt)("code",{parentName:"p",className:"language-text"},"max-age")," is often better since we don't want to ping the origin server too often."),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Hint: it's generally possible to purge a CDN from their UIs or using remote APIs"),"."),(0,l.kt)("h3",null,"stale-while-revalidate"),(0,l.kt)("p",null,(0,l.kt)("code",{parentName:"p",className:"language-text"},"stale-while-revalidate")," allows to return a stale (and cached) version of the content to users for a given period of time but in the meantime, it refreshes its cache by calling the origin server."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"A flow:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"When creating a response on the server, put a ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"max-age=N,stale-while-revalidate=S")," (here, ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"N=10")," and ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"S=20"),") header with a number of seconds"),(0,l.kt)("li",{parentName:"ul"},"When a new request comes in",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"If the user has already visited the page during the last ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"N")," seconds, get the cached value"),(0,l.kt)("li",{parentName:"ul"},"If the user has already visited the page during the last ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"S")," seconds, meaning that ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"max-age")," has expired, still get the cached value BUT revalidate in the background"),(0,l.kt)("li",{parentName:"ul"},"If the user has not visited the page again during the last ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"S")," seconds, meaning that ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"max-age")," and ",(0,l.kt)("code",{parentName:"li",className:"language-text"},"stale-while-revalidate")," has expired, then, the request will hit the origin server, and populate the CDN cache")))))}m.isMDXComponent=!0},4655:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(7294),l=a(4983),r=a(5414),s=a(6455),i={};function o(e){var t=e.children,a=e.pageContext.frontmatter,o="/meta/"+a.metaImage;return n.createElement(l.Zo,{components:i},n.createElement(s.L,null,n.createElement(r.q,null,n.createElement("html",{lang:"en"}),n.createElement("title",null,a.title),n.createElement("meta",{name:"description",content:a.excerpt}),n.createElement("meta",{property:"og:description",content:a.excerpt}),n.createElement("meta",{name:"keywords",content:"HTML, CSS, JavaScript, Accessibility, A11y, e2e, tests, testing, React, React Native"}),n.createElement("meta",{property:"og:title",content:a.title}),n.createElement("meta",{property:"og:image",content:o}),n.createElement("meta",{name:"author",content:"Marvin Frachet"})),n.createElement("main",{"aria-labelledby":"title",className:"wrapper"},n.createElement("h1",{id:"title"},a.title),t)))}},3366:function(e,t,a){function n(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}a.d(t,{Z:function(){return n}})}}]);
//# sourceMappingURL=component---src-snippets-basic-headers-for-http-caching-mdx-baec94d9a5b79219e900.js.map